
https://support.microsoft.com/en-us/topic/how-to-install-multiple-windows-updates-or-hotfixes-with-only-one-reboot-6247def4-7f39-c1a0-efe5-61f82849fb7c

# How to install multiple Windows updates or hotfixes with only one reboot

## Summary
  <p>This article describes how to install multiple Windows product updates (for example, critical updates, security patches, or hotfixes) that use Hotfix.exe (Microsoft Windows NT 4.0) or Update.exe (Microsoft Windows 2000, Microsoft Windows XP, or Microsoft Windows Server 2003) with only one restart. This article is intended for administrators and IT professionals. You can install Windows product updates that use Hotfix.exe or Update.exe either alone or in combination with Windows (with or without a service pack).<br><br><br>
    Note The procedure that is described in this article does not work for product updates that do not use Hotfix.exe or Update.exe as the installation program. For example, Internet Explorer updates for Windows NT 4.0, Windows 2000, and Windows XP use an INF-based installation instead of Update.exe. As a result, you cannot use this procedure to install multiple Microsoft Internet Explorer updates with only one restart on Windows NT 4.0, Windows 2000, or Windows XP. Because Internet Explorer updates for Windows Server 2003 use Update.exe as the installation program, you can use this procedure to install them.<br><br>
    For additional information about these topics, see the following Microsoft Web sites:<br><br>Windows 2000</p><p>Microsoft Windows 2000 Hotfix Installation and Deployment Guide<br><a href="http://technet.microsoft.com/en-us/library/cc750542.aspx" class="ocpExternalLink" target="_blank" data-bi-type="anchor">http://technet.microsoft.com/en-us/library/cc750542.aspx</a>Windows XP</p><p>The Guide for Installing and Deploying Updates for Microsoft Windows XP Service Pack 2<br><a href="http://technet.microsoft.com/en-us/library/bb457071.aspx" class="ocpExternalLink" target="_blank" data-bi-type="anchor">http://technet.microsoft.com/en-us/library/bb457071.aspx</a>Windows Server 2003 and Windows XP Professional x64 Edition</p>
    <p>Guide for Installing and Deploying Updates for Microsoft Windows Server 2003 and Windows XP 64-Bit Edition Version 2003<br>
      <a href="http://technet.microsoft.com/en-us/library/cc700814.aspx" class="ocpExternalLink" target="_blank" data-bi-type="anchor">http://technet.microsoft.com/en-us/library/cc700814.aspx</a>Windows Server 2003 Service Pack 1</p>
    <p>Microsoft Windows Server 2003 Service Pack 1 Installing and Deploying Updates<br><a href="http://technet2.microsoft.com/windowsserver/en/library/0e02a953-aca7-4dad-b3e2-c94ea72bbc3d1033.mspx" class="ocpExternalLink" target="_blank" data-bi-type="anchor">http://technet2.microsoft.com/windowsserver/en/library/0e02a953-aca7-4dad-b3e2-c94ea72bbc3d1033.mspx</a></p></section><section aria-labelledby="ID0EFD" class="ocpSection">
      <h2 id="ID0EFD" class="">More Information</h2>
      <p>A Windows product update (for example, a critical update, a security patch, or a hotfix) is an executable (.exe) file that contains one or more system files that you can apply to Windows to correct a specific problem. Microsoft Product Support Services distributes hotfixes to customers who are severely affected by a specific problem. Critical updates and security patches are updates that Microsoft recommends for all customers. You can obtain critical updates and security patches from the Windows Update Web site, the Microsoft Update Web site, the Microsoft Download Center, or from other Microsoft Web sites.</p><section aria-labelledby="ID0EFDBD" class="ocpSection">
      <h3 id="ID0EFDBD" class="">Windows XP x64 Edition updates and Windows Server 2003 updates or Windows XP and Windows 2000 updates that were created after December 2002</h3><p>
      Note To determine when an update was created, view the Modified date on the Update.exe or Hotfix.exe installation program in the update package.<br><br>To install a Windows product update on a single computer, run the product update program on the computer that you want to update. To install multiple product updates without restarting the computer between each installation, use the /z switch.</p><section aria-labelledby="ID0EDBBDBD" class="ocpSection">
      <h4 id="ID0EDBBDBD" class="">Command-line options for the Update.exe program</h4><p>The following table identifies the command-line options (or switches) that the Update.exe program supports:Switch Description<br>------ -----------<br>
      /f Forces other programs to close at shutdown. /n Does not back up files for removing hotfixes. /z Does not restart the computer after the installation is<br>completed. /q Uses quiet mode; no user interaction is required. /m Uses unattended Setup mode (Windows 2000). /u Uses unattended Setup mode (Windows XP). /l Lists installed hotfixes. The following code sample is a batch file that installs multiple product updates and makes sure that the correct files are replaced after the computer is restarted.</p><code class="ocpCode"><pre>@echo off<br>setlocal<br>set PATHTOFIXES=E:\hotfix<br><br>%PATHTOFIXES%\Q123456_w2k_sp4_x86.exe /Z /M<br>%PATHTOFIXES%\Q123321_w2k_sp4_x86.exe /Z /M<br>%PATHTOFIXES%\Q123789_w2k_sp4_x86.exe /Z /M</pre></code><p>Note QChain.exe functionality is included in all Windows XP x64 Editions, Windows Server 2003, Windows XP, and Windows 2000 product updates that use Update.exe and that were released since May 18, 2001. However, an issue exists in product updates that were released before December 2002 that may apply the wrong binary on your computer in some circumstances. In March 2003, Microsoft released an updated version of QChain.exe to resolve this issue.<br>For additional information about this issue or to obtain the updated Qchain.exe tool, click the following article number to view the article in the Microsoft Knowledge Base:</p><p><a href="http://support.microsoft.com/en-us/help/815062" class="ocpExternalLink" target="_blank" data-bi-type="anchor">815062</a><span> </span>The correct file is not installed when you chain multiple hotfixes<br><br></p></section></section><section aria-labelledby="ID0EFBBD" class="ocpSection"><h3 id="ID0EFBBD" class="">All Windows NT 4.0 updates or Windows XP and Windows 2000 updates that were created before December 2002</h3><p>Note To determine when a product update was created, check the Modified date on the Update.exe or Hotfix.exe installation program in the update package.<br><br>Microsoft has released a command-line tool that is named QChain.exe. With QChain.exe, system administrators can chain updates together. When you chain updates, you install multiple updates without restarting the computer between each installation. Without this tool, the only supported method is to restart the computer after each update installation. The QChain.exe tool has the following benefits:<br></p><ul><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>It increases uptime for servers because computers are not being restarted between each update installation.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>It permits faster installations of multiple updates on a single computer.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>It works on both Windows 2000 and Windows NT 4.0.</p></li></ul>
        <p>Note QChain.exe functionality is included in all Windows XP and Windows 2000 updates that were released since May 18, 2001, but an issue exists in updates released before December 2002 that may result in the wrong binary being placed on your computer in some circumstances. In March 2003, Microsoft released an updated version of QChain.exe to resolve this issue.<br>For more information about this issue or to obtain the updated Qchain.exe tool, click the following article number to view the article in the Microsoft Knowledge Base:<br><br></p>
        <p><a href="http://support.microsoft.com/en-us/help/815062" class="ocpExternalLink" target="_blank" data-bi-type="anchor">815062</a><span> </span>The correct file is not installed when you chain multiple hotfixes<br><br></p><section aria-labelledby="ID0EDNBBBD" class="ocpSection"><h4 id="ID0EDNBBBD" class="">Chaining update installations without QChain.exe is not safe</h4><p>When you install updates, if a file is locked or in use, it cannot be replaced. As a result, the file is placed in the Pending File Rename queue and is replaced after the computer restarts. The problem occurs in the following scenario:<br></p><ul><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
          <p>You install updates A and B without restarting the computer between installations.</p>
        </li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
          <p>Both packages contain file X. Package A's file X is version 3; package B's file X is version 2. The version of file X on the computer is version 1.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>When package A is installed, it places its version of file X in the Pending File Rename queue.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>
            When package B is installed, it places its version of file X in the Pending File Rename queue.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>When the computer is restarted, because package B was installed last, its version of file X is installed (in the Pending File Rename queue, the last file is the one that is used). As a result, version 2 is installed instead of version 3 as you expected.</p>
        </li></ul></section><section aria-labelledby="ID0EDLBBBD" class="ocpSection"><h4 id="ID0EDLBBBD" class="">If previously chained updates are installed without restarting</h4><p>Although this scenario is rare, it is good practice to verify that your computer has all the fixes that you believe are installed. To verify this, use the Qfecheck.exe tool.<br>For more information about Qfecheck.exe, click the following article number to view the article in the Microsoft Knowledge Base:<br><br></p>
          <p><a href="http://support.microsoft.com/en-us/help/282784" class="ocpExternalLink" target="_blank" data-bi-type="anchor">282784</a><span> </span>Qfecheck.exe verifies the installation of Windows 2000 and Windows XP hotfixes<br><br>QChain.exe cleans the Pending File Rename Operations key in the registry to make sure that only the latest version of a file is installed after the computer is restarted.</p></section><section aria-labelledby="ID0EDJBBBD" class="ocpSection"><h4 id="ID0EDJBBBD" class="">To install multiple updates with only one restart</h4><ol type="1" itemscope="" itemtype="http://schema.org/ItemList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>Run the update installer with the -z switch to instruct the installer not to restart after the installation. Add the -m switch (for Quiet mode) if you do not want prompts or messages to appear during the installation.<br><br>The update installer is one of the following programs:<br></p><ul><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>The self-extracting package program file (for example, Q<b class="ocpLegacyBold">nnnnnn</b>_w2k_sp<b class="ocpLegacyBold">x</b>_x86_en.exe).</p></li>
            <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>Hotfix.exe (if you have extracted all the files from the package).</p></li></ul></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>After you install all the hotfixes, run QChain.exe.<br></p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>Restart the computer.</p></li></ol><p>You can also create a batch file to do this. The following sample batch file demonstrates this method:</p><code class="ocpCode"><pre>@echo off<br>setlocal<br>set PATHTOFIXES=some path%PATHTOFIXES%\Q123456_w2k_sp2_x86.exe -z -m<br>%PATHTOFIXES%\Q123321_w2k_sp2_x86.exe -z -m<br>%PATHTOFIXES%\Q123789_w2k_sp2_x86.exe -z -m<br>%PATHTOFIXES%\qchain.exe<br></pre></code></section><section aria-labelledby="ID0EDHBBBD" class="ocpSection">
              <h4 id="ID0EDHBBBD" class="">How to obtain QChain.exe</h4><p>QChain.exe functionality is included in all Windows XP and Windows 2000 updates that were released since May 18, 2001, but an issue exists in updates that were released before December 2002 that may result in the wrong binary being placed on your computer in some circumstances. In March 2003, Microsoft released an updated version of QChain.exe to resolve this issue.<br>For more information about this issue or to obtain the updated Qchain.exe tool, click the following article number to view the article in the Microsoft Knowledge Base:<br><br></p><p><a href="http://support.microsoft.com/en-us/help/815062" class="ocpExternalLink" target="_blank" data-bi-type="anchor">815062</a><span> </span>The correct file is not installed when you chain multiple hotfixes<br><br></p></section><section aria-labelledby="ID0EDFBBBD" class="ocpSection"><h4 id="ID0EDFBBBD" class="">The QChain.exe Command Syntax</h4><p>qchain [<b class="ocpLegacyBold">logfilename</b>]<br>
            The optional [<b class="ocpLegacyBold">logfilename</b>] parameter creates a file with a before and after snapshot of the Pending File Rename Operations key.</p></section><section aria-labelledby="ID0EDDBBBD" class="ocpSection"><h4 id="ID0EDDBBBD" class="">Sample QChain.exe output</h4><p id="bkmk_issue">---- Old Information In The Registry ------<br>
            Source:C:\WINNT\inf\acpi.inf<br>Version: 5.0.2183.1<br>Destination:d:\ntsust\testregchech\1394.inf<br>Version: 5.0.2183.1<br><br>Source:C:\WINNT\inf\adm_mult.inf<br>Version: 5.0.2184.1<br>Destination:d:\ntsust\testregchech\1394.inf<br>Version: 5.0.2183.1<br><br>Source:C:\WINNT\inf\banshee.inf<br>Version: 5.0.2080.1<br>Destination:d:\ntsust\testregchech\1394.inf<br>Version: 5.0.2183.1<br><br>---- New Information In The Registry ------<br>Source:C:\WINNT\inf\adm_mult.inf<br>Version: 5.0.2184.1<br>Destination:d:\ntsust\testregchech\1394.inf<br>Version: 5.0.2183.1<br></p></section><section aria-labelledby="ID0EDBBBBD" class="ocpSection"><h4 id="ID0EDBBBBD" class="">Limitations of QChain.exe</h4>
              <p>Although QChain works with most Windows NT 4.0 and Windows 2000 updates, QChain.exe may not work with updates that contain binary files that are listed in the following registry key:</p><p><b class="ocpLegacyBold">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDLLs</b><span> </span>Binary files (binaries) that are listed in this registry key are loaded in memory at startup. When the update installer calls the GetFileVersionInfo function on a binary from this list, update installer refers to the binary that is already loaded instead of the binary that is actually present in the target location.<br><br>Because the binaries that are listed in the<span> </span><b class="ocpLegacyBold">KnownDLLs</b><span> </span>registry key load into memory at startup, the update installer must replace the target binary with the fixed binary before the computer restarts. Therefore, the update installer does not create a Pending File Rename Operation to replace the binary at restart. Instead, the update moves the current binary to a temporary location, puts the fixed binary where the current binary was, and then creates a Pending File Rename Operation to delete the current binary when the computer restarts.<br><br>QChain affects only Pending File Rename Operations that perform binary replacement operations. It does not do anything with Pending File Rename Operations that perform delete operations.<br><br>All Windows NT 4.0 updates and all Windows 2000 updates that are earlier than SP2 use GetFileVersionInfo to identify the version of a file. If you install two or more Windows NT 4.0 updates or pre-SP2 Windows 2000 updates, and the updates contain overlapping KnownDLLs, the use of QChain to chain the installation of those updates does not make sure that the latest-versioned fix is installed.<br><br>The following scenario shows why QChain may not put the correct binary on the system:<br></p><ul><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>You install update packages A and B and you do not restart between installations.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>
              Both packages contain Kernel32.dll, a file that is in the KnownDLLs list. Package A includes Kernel32.dll version 3, package B includes Kernel32.dll version 2, and the computer has Kernel32.dll version 1 installed.</p></li>
              <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>When package A is installed, GetFileVersionInfo reports that the computer has Kernel32.dll version 1. Because package A includes version 3, the update installer identifies the need for file replacement.<br></p><ul><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>The update installer moves the Kernel32.dll version 1 on the computer to a temporary location and creates a Pending File Rename Operation to delete the Kernel32.dll file from the temporary location the next time the computer restarts.</p></li>
                <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>
                  Package A's Kernel32.dll version 3 is copied to the computer.</p></li></ul></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>When package B installs, GetFileVersionInfo still reports that Kernel32.dll version 1 is installed on the computer because GetFileVersionInfo reads the version information from the Kernel32.dll that is loaded in memory. Package B has version 2, and the hotfix therefore identifies the need for file replacement.<br></p><ul>
                    <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>The update installer moves the Kernel32.dll that is now on the computer (package A's Kernel32.dll version 3) to a temporary location and creates a Pending File Rename Operation to delete the (version 3) Kernel32.dll from the temporary location the next time the computer restarts.<br></p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>Package B's Kernel32.dll version 2 is copied to the computer.</p></li></ul></li>
              <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>QChain runs, but there are no Pending File Rename Operations for file replacement and QChain therefore does nothing.</p></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><p>Because package B installed most recently, the package B Kernel32.dll version 2 is in the correct location on the computer. Therefore, it loads into memory when the computer restarts. The Pending File Rename Operations delete both the original Kernel32.dll version 1 and package A's Kernel32.dll version 3. As a result, the computer now has Kernel32.dll version 2 instead of version 3.</p></li></ul>
              <p>There is a post-SP2 Windows 2000 fix where GetFileVersionInfo is no longer used on the KnownDLLs that are loaded in memory. Instead, the update installer maps the file that is actually present in the target location, and then calls GetFileVersionInfo on the mapped file. Therefore, you can use QChain.exe to chain post-SP2 Windows 2000 updates together. When you do so, the latest version of a file is installed, regardless of the order the updates are installed.<br><br>
                If you replay the previous scenario, and use post-SP2 Windows 2000 updates, the hotfix in package B maps package A's Kernel32.dll and recognizes version 3. Version 3 is later than package B's own Kernel32.dll version 2. Therefore, package B does not replace the Kernel32.dll that is on the system, and package A's Kernel32.dll version 3 is the version that the computer correctly uses after the computer restarts.</p></section></section></section></article>

 How to install multiple Windows updates or hotfixes with only one reboot"
 href="mailto://?subject=How%20to%20install%20multiple%20Windows%20updates%20or%20hotfixes%20with%20only%20one%20reboot&amp;body=How%20to%20install%20multiple%20Windows%20updates%20or%20hotfixes%20with%20only%20one%20reboot%20https%3A%2F%2Fsupport.microsoft.com%2Fen-us%2Ftopic%2Fhow-to-install-multiple-windows-updates-or-hotfixes-with-only-one-reboot-6247def4-7f39-c1a0-efe5-61f82849fb7c">

